{% extends "base.html" %}
{% load static %}

{% block seo %}
<title>–ó–∞—è–≤–∫–∏ - Healthcare (–î–æ–∫—Ç–æ—Ä)</title>
{% endblock seo %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/requests.css' %}" />
<link rel="stylesheet" href="{% static 'css/pagination.css' %}" />
{% endblock styles %}

{% block content %}
<div class="requests-container">
    <div class="requests-header">
        <h1>–ó–∞—è–≤–∫–∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</h1>
        <div class="filter-tabs">
            <a href="?filter=available" class="tab {% if filter_type == 'available' %}active{% endif %}">
                –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞—è–≤–∫–∏
            </a>
            <a href="?filter=my" class="tab {% if filter_type == 'my' %}active{% endif %}">
                –ú–æ–∏ –∑–∞—è–≤–∫–∏
            </a>
        </div>
    </div>
    
    {% if requests %}
        <div class="requests-list">
            {% for request in requests %}
            <div class="request-card">
                <div class="request-header">
                    <div>
                        <h3 class="request-title">{{ request.title }}</h3>
                        <div class="request-meta">
                            {{ request.created_at|date:"d.m.Y H:i" }}
                        </div>
                    </div>
                    <span class="specialization-badge">
                        {{ request.get_specialization_display }}
                    </span>
                </div>
                
                <div class="request-description">
                    {{ request.description|truncatewords:50 }}
                </div>
                
                <div class="request-footer">
                    <div class="patient-info">
                        <strong>–ü–∞—Ü–∏–µ–Ω—Ç:</strong> {{ request.patient.username }}
                    </div>
                    
                    {% if filter_type == 'available' %}
                        <form method="post" action="{% url 'chat:request_accept' request.pk %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-accept">‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É</button>
                        </form>
                    {% else %}
                        <a href="{% url 'chat:chat_detail' request.chat.pk %}" class="btn-chat">üí¨ –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?filter={{ filter_type }}&page=1">–ü–µ—Ä–≤–∞—è</a>
                <a href="?filter={{ filter_type }}&page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a>
            {% endif %}
            
            <span class="current">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
            
            {% if page_obj.has_next %}
                <a href="?filter={{ filter_type }}&page={{ page_obj.next_page_number }}">–í–ø–µ—Ä—ë–¥</a>
                <a href="?filter={{ filter_type }}&page={{ page_obj.paginator.num_pages }}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <h3>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞—è–≤–æ–∫</h3>
            <p>
                {% if filter_type == 'my' %}
                    –í—ã –µ—â—ë –Ω–µ –ø—Ä–∏–Ω—è–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –∑–∞—è–≤–∫–∏
                {% else %}
                    –ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –ø–æ –≤–∞—à–µ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                {% endif %}
            </p>
        </div>
    {% endif %}
</div>
{% endblock content %}
